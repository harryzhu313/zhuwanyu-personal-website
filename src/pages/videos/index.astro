---
import { getCollection } from "astro:content";
import CollectionLayout from "../../layouts/CollectionLayout.astro";
import { type Video, yymmdd, slugify } from "../..";
import { Stream } from "@cloudflare/stream-react";
import Introduction from "../../components/Introduction.astro";
import { preprocessVideo } from "../../content/config";

// 安全获取 videos 集合
let videos;
let nodes: Video[] = [];

try {
  videos = await getCollection("videos");
  if (videos && videos.length > 0) {
    nodes = await Promise.all(videos.map(preprocessVideo));
  }
} catch (error) {
  console.error("获取 videos 集合时出错:", error);
  nodes = [];
}
---

<CollectionLayout collection="videos">
  <Introduction collection="videos">
    <p style="text-align: justify;">1895 年 12 月 28 日。那天晚上，卢米埃尔兄弟在巴黎卡普辛大道的"印度咖啡馆"地下室，用他们自研的 Cinématographe 向付费观众放映了十段短片——这是历史上第一次公开售票的放映，也第一次把摄影机、冲印机和放映机三合一地带到公众面前，从此"电影"才真正成为一种大众艺术形式。如今随着摄影技术的成熟，每个人都可以做自己生活的导演，与他人分享生命中的美好时刻。</p>
    <p style="margin-top: 10px;">本页面正在建设中，过一段时间回来看看会发现更多内容哦～</p>
  </Introduction>
  <section class="section">
    {
      nodes.length > 0 ? (
        nodes.map(({ uid, title: name, date }) => {
          return (
            <article class="container content is-max-desktop">
              <h2>
                <a href={slugify(name)}>{name}</a>
              </h2>
              <p>{yymmdd(date)}</p>
              <div>
                <Stream controls src={uid} client:only />
              </div>
            </article>
          );
        })
      ) : (
        <div class="container content is-max-desktop">
          <p>视频集合正在建设中，请稍后再来查看。</p>
        </div>
      )
    }
  </section>
</CollectionLayout>
