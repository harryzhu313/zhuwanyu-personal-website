---
// Temporarily disabled for build
// import { notionLoader } from "notion-astro-loader";

let debugInfo = {
  hasToken: false,
  tokenLength: 0,
  databaseId: "",
  rawData: null,
  error: null,
};

try {
  // æ£€æŸ¥ç¯å¢ƒå˜é‡
  const token = import.meta.env.NOTION_TOKEN;
  debugInfo.hasToken = !!token;
  debugInfo.tokenLength = token?.length || 0;
  debugInfo.databaseId = "1dc62405089a80cdb786d46602d9d582";

  if (token) {
    // å°è¯•è·å–åŸå§‹æ•°æ®
    const loader = notionLoader({
      auth: token,
      database_id: debugInfo.databaseId,
    });
    
    const rawData = await loader();
    debugInfo.rawData = rawData;
    
    console.log('ğŸ” Notion Debug - åŸå§‹æ•°æ®:', {
      dataLength: rawData?.length || 0,
      firstEntry: rawData?.[0] ? {
        id: rawData[0].id,
        hasData: !!rawData[0].data,
        hasCover: !!rawData[0].data?.cover,
        hasProperties: !!rawData[0].data?.properties,
        propertiesKeys: rawData[0].data?.properties ? Object.keys(rawData[0].data.properties) : [],
      } : null
    });
  }
} catch (error) {
  debugInfo.error = error;
  console.error('ğŸ” Notion Debug - é”™è¯¯:', error);
}
---

<!DOCTYPE html>
<html>
<head>
  <title>Notion Debug</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .success { color: green; }
    .error { color: red; }
    .warning { color: orange; }
    pre { background: #f5f5f5; padding: 10px; overflow: auto; }
  </style>
</head>
<body>
  <h1>Notion è¿æ¥è°ƒè¯•ä¿¡æ¯</h1>
  
  <h2>ç¯å¢ƒå˜é‡æ£€æŸ¥</h2>
  <p class={debugInfo.hasToken ? "success" : "error"}>
    NOTION_TOKEN: {debugInfo.hasToken ? `âœ… å·²è®¾ç½® (é•¿åº¦: ${debugInfo.tokenLength})` : "âŒ æœªè®¾ç½®"}
  </p>
  <p>æ•°æ®åº“ID: {debugInfo.databaseId}</p>
  
  <h2>æ•°æ®è·å–ç»“æœ</h2>
  {debugInfo.error ? (
    <div class="error">
      <p>âŒ è·å–æ•°æ®æ—¶å‡ºé”™:</p>
      <pre>{debugInfo.error.toString()}</pre>
    </div>
  ) : debugInfo.rawData ? (
    <div class="success">
      <p>âœ… æˆåŠŸè·å–æ•°æ®</p>
      <p>æ¡ç›®æ•°é‡: {debugInfo.rawData.length}</p>
      {debugInfo.rawData.length > 0 && (
        <div>
          <h3>ç¬¬ä¸€ä¸ªæ¡ç›®ç»“æ„:</h3>
          <pre>{JSON.stringify(debugInfo.rawData[0], null, 2)}</pre>
        </div>
      )}
    </div>
  ) : (
    <p class="warning">âš ï¸ æ­£åœ¨è·å–æ•°æ®...</p>
  )}
  
  <hr>
  <p><a href="/">è¿”å›é¦–é¡µ</a> | <a href="/photos">æŸ¥çœ‹ç…§ç‰‡é¡µé¢</a></p>
</body>
</html> 